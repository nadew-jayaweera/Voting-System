<!DOCTYPE html>
<html>
<head>
    <title>Live Results</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root {
            --bg: radial-gradient(circle at 20% 20%, rgba(80, 147, 255, 0.18), transparent 35%),
                  radial-gradient(circle at 80% 10%, rgba(255, 99, 146, 0.18), transparent 30%),
                  #0a0f1c;
            --panel: rgba(255, 255, 255, 0.06);
            --border: rgba(255, 255, 255, 0.12);
            --text-main: #f5f7ff;
            --text-dim: #9fb0d8;
            --accent: #7dd3fc;
            --accent-2: #c084fc;
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Space Grotesk', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 32px;
        }

        .shell {
            width: min(1200px, 100%);
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .title-wrap h1 { margin: 0; font-size: 32px; letter-spacing: 0.5px; }
        .title-wrap p { margin: 6px 0 0; color: var(--text-dim); }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--panel);
            border: 1px solid var(--border);
            padding: 10px 14px;
            border-radius: 14px;
            backdrop-filter: blur(10px);
            font-weight: 600;
            color: var(--accent);
        }

        .pulse-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #22c55e;
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.6);
            animation: pulse 1.6s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.5); }
            70% { box-shadow: 0 0 0 12px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        .meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
        }

        .pill {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 14px 16px;
            backdrop-filter: blur(10px);
        }

        .pill .label { color: var(--text-dim); font-size: 14px; }
        .pill .value { font-size: 22px; font-weight: 600; margin-top: 6px; }

        .panel {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px;
            backdrop-filter: blur(12px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
        }

        .chart-shell { position: relative; height: min(70vh, 620px); }

        canvas { width: 100% !important; height: 100% !important; }

        @media (max-width: 768px) {
            body { padding: 18px; }
            .top-bar { flex-direction: column; align-items: flex-start; }
            .title-wrap h1 { font-size: 26px; }
            .chart-shell { height: 420px; }
        }
    </style>
</head>
<body>
    <div class="shell">
        <div class="top-bar">
            <div class="title-wrap">
                <p>Competition Dashboard</p>
                <h1>Live Results</h1>
            </div>
            <div class="status">
                <span class="pulse-dot"></span>
                Live feed
            </div>
        </div>

        <div class="meta">
            <div class="pill">
                <div class="label">Total votes</div>
                <div class="value" id="total-votes">0</div>
            </div>
            <div class="pill">
                <div class="label">Last update</div>
                <div class="value" id="last-update">â€”</div>
            </div>
        </div>

        <div class="panel">
            <div class="chart-shell">
                <canvas id="voteChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        var socket = io();
        var ctx = document.getElementById('voteChart').getContext('2d');
        var totalVotesEl = document.getElementById('total-votes');
        var lastUpdateEl = document.getElementById('last-update');

        var palette = [
            'rgba(125, 211, 252, 0.9)',
            'rgba(192, 132, 252, 0.9)',
            'rgba(244, 114, 182, 0.9)',
            'rgba(96, 165, 250, 0.9)',
            'rgba(52, 211, 153, 0.9)',
            'rgba(251, 191, 36, 0.9)'
        ];

        var chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['C1', 'C2', 'C3', 'C4'],
                datasets: [{
                    label: 'Live votes',
                    data: [0, 0, 0, 0],
                    backgroundColor: palette,
                    borderColor: 'rgba(255,255,255,0.4)',
                    borderWidth: 1.5,
                    borderRadius: 10,
                    maxBarThickness: 80
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: { padding: 10 },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255,255,255,0.08)' },
                        ticks: { color: 'var(--text-dim)', precision: 0 }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: 'var(--text-main)', font: { size: 14, weight: '600' } }
                    }
                },
                plugins: {
                    legend: { labels: { color: 'var(--text-dim)', boxWidth: 12 } },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.92)',
                        borderColor: 'rgba(255,255,255,0.08)',
                        borderWidth: 1,
                        titleColor: '#fff',
                        bodyColor: '#dbeafe'
                    }
                },
                animation: {
                    duration: 650,
                    easing: 'easeOutCubic'
                }
            }
        });

        function refreshChart(scores) {
            if (!scores || Object.keys(scores).length === 0) return;

            // Extract IDs and sort them
            var ids = Object.keys(scores).sort(function(a, b) { return Number(a) - Number(b); });
            
            // Get names and vote counts
            var labels = ids.map(function(id) { 
                return scores[id].name || ('C' + id);
            });
            var values = ids.map(function(id) { 
                return scores[id].votes || 0;
            });

            chart.data.labels = labels;
            chart.data.datasets[0].data = values;
            chart.data.datasets[0].backgroundColor = values.map(function(_, idx) {
                return palette[idx % palette.length];
            });

            var total = values.reduce(function(sum, v) { return sum + Number(v || 0); }, 0);
            totalVotesEl.textContent = total.toLocaleString();
            lastUpdateEl.textContent = new Date().toLocaleTimeString();

            chart.update();
        }

        socket.on('update_scores', function(scores) {
            refreshChart(scores);
        });
    </script>
</body>
</html>

