<!DOCTYPE html>
<html lang="en">
<head>
    <title>Live Results</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * { 
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Space Grotesk', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 32px;
            position: relative;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveGrid 20s linear infinite;
            z-index: 0;
        }

        @keyframes moveGrid {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .shell {
            width: min(1200px, 100%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            z-index: 1;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 14px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            border-radius: 18px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .title-wrap p { 
            margin: 0 0 6px;
            color: #667eea;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .title-wrap h1 { 
            margin: 0; 
            font-size: 2.2rem;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.12), rgba(22, 163, 74, 0.12));
            border: 2px solid rgba(34, 197, 94, 0.4);
            padding: 12px 18px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            font-weight: 700;
            color: #16a34a;
            font-size: 0.95rem;
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #22c55e;
            box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.6);
            animation: pulse 1.8s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.5); }
            70% { box-shadow: 0 0 0 15px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        .meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
        }

        .pill {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.2rem 1.5rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .pill:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .pill .label { 
            color: #666;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .pill .value { 
            font-size: 1.6rem;
            font-weight: 700;
            margin-top: 8px;
            color: #667eea;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .chart-shell { 
            position: relative; 
            height: min(70vh, 620px);
        }

        canvas { 
            width: 100% !important; 
            height: 100% !important; 
        }

        @media (max-width: 768px) {
            body { padding: 18px; }
            .top-bar { 
                flex-direction: column; 
                align-items: flex-start;
                padding: 1.2rem 1.5rem;
            }
            .title-wrap h1 { font-size: 1.8rem; }
            .chart-shell { height: 420px; }
            .panel { padding: 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="shell">
        <div class="top-bar">
            <div class="title-wrap">
                <p>Competition Dashboard</p>
                <h1>Live Results</h1>
            </div>
            <div class="status">
                <span class="pulse-dot"></span>
                <span>Live feed</span>
            </div>
        </div>

        <div class="meta">
            <div class="pill">
                <div class="label"><i class="fas fa-chart-bar"></i> Total votes</div>
                <div class="value" id="total-votes">0</div>
            </div>
            <div class="pill">
                <div class="label"><i class="fas fa-clock"></i> Last update</div>
                <div class="value" id="last-update">â€”</div>
            </div>
        </div>

        <div class="panel">
            <div class="chart-shell">
                <canvas id="voteChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        var socket = io();
        var ctx = document.getElementById('voteChart').getContext('2d');
        var totalVotesEl = document.getElementById('total-votes');
        var lastUpdateEl = document.getElementById('last-update');

        var palette = [
            'rgba(125, 211, 252, 0.9)',
            'rgba(192, 132, 252, 0.9)',
            'rgba(244, 114, 182, 0.9)',
            'rgba(96, 165, 250, 0.9)',
            'rgba(52, 211, 153, 0.9)',
            'rgba(251, 191, 36, 0.9)'
        ];

        var chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['C1', 'C2', 'C3', 'C4'],
                datasets: [{
                    label: 'Live votes',
                    data: [0, 0, 0, 0],
                    backgroundColor: palette,
                    borderColor: 'rgba(255,255,255,0.4)',
                    borderWidth: 1.5,
                    borderRadius: 10,
                    maxBarThickness: 80
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: { padding: 10 },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255,255,255,0.08)' },
                        ticks: { color: 'var(--text-dim)', precision: 0 }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: 'var(--text-main)', font: { size: 14, weight: '600' } }
                    }
                },
                plugins: {
                    legend: { labels: { color: 'var(--text-dim)', boxWidth: 12 } },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.92)',
                        borderColor: 'rgba(255,255,255,0.08)',
                        borderWidth: 1,
                        titleColor: '#fff',
                        bodyColor: '#dbeafe'
                    }
                },
                animation: {
                    duration: 650,
                    easing: 'easeOutCubic'
                }
            }
        });

        function refreshChart(scores) {
            if (!scores || Object.keys(scores).length === 0) return;

            // Extract IDs and sort them
            var ids = Object.keys(scores).sort(function(a, b) { return Number(a) - Number(b); });
            
            // Get names and vote counts
            var labels = ids.map(function(id) { 
                return scores[id].name || ('C' + id);
            });
            var values = ids.map(function(id) { 
                return scores[id].votes || 0;
            });

            chart.data.labels = labels;
            chart.data.datasets[0].data = values;
            chart.data.datasets[0].backgroundColor = values.map(function(_, idx) {
                return palette[idx % palette.length];
            });

            var total = values.reduce(function(sum, v) { return sum + Number(v || 0); }, 0);
            totalVotesEl.textContent = total.toLocaleString();
            lastUpdateEl.textContent = new Date().toLocaleTimeString();

            chart.update();
        }

        socket.on('update_scores', function(scores) {
            refreshChart(scores);
        });
    </script>
</body>
</html>

